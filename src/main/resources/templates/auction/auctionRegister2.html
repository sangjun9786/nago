<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>경매 등록 | BuyYourBrain</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .form-section { background: #f8f9fa; padding: 30px; border-radius: 10px; }
        .form-title { font-weight: bold; font-size: 1.4rem; }
    </style>
</head>
<body>
<div class="container my-5">
    <h2 class="text-center mb-4">경매 등록</h2>

    <form th:action="@{/auction/register}" method="post" id="auctionForm">
        <div class="form-section shadow-sm">

            <div class="form-step" id="step1">
                <label class="form-label form-title">카테고리</label>
                <select class="form-select" name="category" id="category">
                    <option selected disabled>카테고리를 선택하세요</option>
                    <option value="dev">개발</option>
                    <option value="design">디자인</option>
                </select>
            </div>

            <div class="form-step d-none" id="step2">
                <label class="form-label form-title">경매 주체</label>
                <select class="form-select" name="requestType" id="requestType">
                    <option value="individual">개인</option>
                    <option value="team">팀</option>
                </select>
            </div>

            <div class="form-step d-none" id="step3">
                <label class="form-label form-title">경매 지역</label>
                <select class="form-select" name="regionId" id="regionId">
                    <option value="1">서울</option>
                    <option value="2">부산</option>
                </select>
            </div>

            <div class="form-step d-none" id="step4">
                <label class="form-label form-title">경매 제목</label>
                <input type="text" class="form-control" name="title" id="title">
            </div>

            <div class="form-step d-none" id="step5">
                <label class="form-label form-title">상세 설명</label>
                <textarea class="form-control" name="description" rows="5" id="description"></textarea>
            </div>

            <div class="form-step d-none" id="step6">
                <label class="form-label form-title">경매 시작가</label>
                <input type="number" class="form-control" name="startPrice" id="startPrice" step="10000" placeholder="₩ 단위 (10,000원 단위)">
            </div>

            <div class="form-step d-none" id="step7">
                <label class="form-label form-title">즉시 입찰가</label>
                <input type="number" class="form-control" name="endPrice" id="endPrice">
            </div>

            <div class="form-step d-none" id="step8">
                <label class="form-label form-title">경매 기간</label>
                <div class="row">
                    <div class="col-md-6"><input type="date" class="form-control" name="actionStartDay" id="actionStartDay"></div>
                    <div class="col-md-6"><input type="date" class="form-control" name="actionEndDay" id="actionEndDay"></div>
                </div>
            </div>

            <div class="form-step d-none" id="step9">
                <label class="form-label form-title">업무 시작일</label>
                <input type="date" class="form-control" name="startDate" id="startDate">
            </div>

            <div class="form-step d-none" id="step10">
                <label class="form-label form-title">납기 희망일</label>
                <input type="date" class="form-control" name="dueDate" id="dueDate">
            </div>

            <div class="form-step d-none" id="step11">
                <label class="form-label form-title">즉시 낙찰 가능 여부</label>
                <select class="form-select" name="isDirect" id="isDirect">
                    <option value="Y">가능</option>
                    <option value="N">불가능</option>
                </select>
            </div>

            <div class="form-step d-none" id="step12">
                <label class="form-label form-title">지원 방식</label>
                <select class="form-select" name="applyType" id="applyType">
                    <option value="general">일반경매</option>
                    <option value="chat">채팅경매</option>
                </select>
            </div>

            <div class="text-center mt-4 form-step d-none" id="step13">
                <button type="submit" class="btn btn-primary px-5">경매 등록</button>
            </div>
        </div>
    </form>
</div>

<script>
    const steps = Array.from(document.querySelectorAll('.form-step'));
    const ids = steps.map(s => s.id);
    const triggers = [
        'category', 'requestType', 'regionId', 'title',
        'description', 'startPrice', 'endPrice', 'actionEndDay',
        'startDate', 'dueDate', 'isDirect', 'applyType'
    ];

    triggers.forEach((id, index) => {
        const el = document.getElementById(id);
        if (el) {
            el.addEventListener('change', () => {
                const next = document.getElementById(`step${index + 2}`);
                if (next) next.classList.remove('d-none');
            });
            el.addEventListener('input', () => {
                const next = document.getElementById(`step${index + 2}`);
                if (next) next.classList.remove('d-none');
            });
        }
    });
    
 // 날짜 유효성 검증 함수들
    function validateAuctionDates() {
        const start = new Date(document.getElementById("actionStartDay").value);
        const end = new Date(document.getElementById("actionEndDay").value);
        if (start && end && end < start) {
            alert("경매 종료일은 경매 시작일보다 빠를 수 없습니다.");
            document.getElementById("actionEndDay").value = "";
        }
    }

    function validateWorkDates() {
        const actionEnd = new Date(document.getElementById("actionEndDay").value);
        const startDate = new Date(document.getElementById("startDate").value);
        if (startDate && actionEnd && startDate <= actionEnd) {
            alert("업무 시작일은 경매 종료일 이후여야 합니다.");
            document.getElementById("startDate").value = "";
        }
    }

    function validateDueDate() {
        const startDate = new Date(document.getElementById("startDate").value);
        const dueDate = new Date(document.getElementById("dueDate").value);
        if (dueDate && startDate && dueDate <= startDate) {
            alert("납기 희망일은 업무 시작일 이후여야 합니다.");
            document.getElementById("dueDate").value = "";
        }
    }
    
 // 이벤트 바인딩
    document.getElementById("actionEndDay").addEventListener("change", validateAuctionDates);
    document.getElementById("actionStartDay").addEventListener("change", validateAuctionDates);

    document.getElementById("startDate").addEventListener("change", validateWorkDates);
    document.getElementById("actionEndDay").addEventListener("change", validateWorkDates);

    document.getElementById("dueDate").addEventListener("change", validateDueDate);
    document.getElementById("startDate").addEventListener("change", validateDueDate);

 // 시작가 10,000원 단위 체크 (입력된 경우만)
  const startPriceInput = document.getElementById("startPrice");
    startPriceInput.addEventListener("blur", function () {
        const value = this.value.trim();

        // 입력값이 없으면 검사 안 함
        if (value === "") return;

        const price = parseInt(value, 10);
        if (isNaN(price)) return;

        if (price % 10000 !== 0) {
            alert("경매 시작가는 10,000원 단위로 입력해주세요.");
            this.value = Math.floor(price / 10000) * 10000;
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>