<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <meta charset="UTF-8">
  <title>워커 작업 세션 대시보드</title>
 <link rel="stylesheet" th:href="@{/css/session.css}">
</head>
<body>
  <div class="container">
    <h2>워커 작업 세션</h2>
    <!-- 마일스톤 계기판 -->
    <div class="milestones">
      <!-- 마일스톤1 -->
      <div class="gauge gauge1">
		  <svg>
		    <circle class="circle-bg" cx="40" cy="40" r="32"></circle>
		    <!-- 시작은 항상 0 -->
		    <circle class="circle-bar" cx="40" cy="40" r="32"
		            stroke-dasharray="0 201"
		            th:attr="data-value=${mile1.graphValue}"
		            ></circle> <!-- 서버에서 graphValue1 값 대입 -->
		  </svg>
		  <div class="gauge-label">마일스톤1 <br>초기 설계</div>
        <div class="gauge-value" th:text="${mile1.rateValue} + '%'"></div>
      </div>
      <!-- 마일스톤2 -->
      <div class="gauge gauge2">
        <svg>
          <circle class="circle-bg" cx="40" cy="40" r="32"></circle>
          <circle class="circle-bar" cx="40" cy="40" r="32"
                  stroke-dasharray="0 201"
                  th:attr="data-value=${mile2.graphValue}"></circle>
        </svg>
        <div class="gauge-label">마일스톤2<br>UI 개발</div>
        <div class="gauge-value" th:text="${mile2.rateValue} + '%'"></div>
      </div>
      
    </div>

    <!-- 출근부(태그 기록) 표 -->
    <table>
      <thead>
        <tr>
          <th>날짜</th>
          <th>출근 시각</th>
          <th>퇴근 시각</th>
          <th>출근 상태</th>
          <th>비고</th>
        </tr>
      </thead>
      <tbody>
        <!-- 동적 데이터가 내부에 들어가야함 -->
        <tr th:each="work : ${sessionList}" th:if="${work.day} <= ${today}"	>
          <td th:text="${work.day}"></td>
          <td th:text="${work.startedAt}"></td>
          <td th:text="${work.endedAt}"></td>
          <td>
          	<span th:classappend="'status-' + ${work.status}" th:switch="${work.status}" >
          		<span th:case="complete">정상</span>
          		<span th:case="late">지각</span>
          		<span th:case="absence">결근</span>
          		<span th:case="no_tagging_out">퇴근 태깅 누락</span>
          		<span th:case="in_progress"></span>
          	</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <script type="text/javascript">
  
  document.querySelectorAll('.circle-bar').forEach(bar => {
	  let target = parseFloat(bar.getAttribute('data-value'));
	  animateGauge(bar, target);
	});
  
  // 게이지 채우기 애니메이션 함수
  function animateGauge(bar, targetValue) {
	  let current = 0;
	  let step = targetValue / 60; // 60프레임 기준
	  let interval = setInterval(() => {
	    current += step;
	    if (current >= targetValue) {
	      current = targetValue;
	      clearInterval(interval);
	    }
	    bar.setAttribute('stroke-dasharray', current + ' 201');
	  }, 16); // 약 60fps
	}


  
  </script>
</body>
</html>
